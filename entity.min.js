/* Entity Game Engine | MIT License */
(function(t){var e;e="undefined"!=typeof exports?exports:t.en={},"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define(function(){return e}),e.$=function(t){return document.getElementById(t.substr(1))},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(s,n){function i(){!t&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;t=!0;var o=new this;t=!1;var a;for(a in s)o[a]="function"==typeof s[a]&&"function"==typeof r[a]&&e.test(s[a])?function(t,e){return function(){var s=this._super;this._super=r[t];var n=e.apply(this,arguments);return this._super=s,n}}(a,s[a]):s[a];if(n)for(a in n)i[a]=n[a];return i.prototype=o,i.prototype.constructor=i,i.extend=arguments.callee,i}}(e),e.Entity=e.Events.extend({}),e.Events=e.Class.extend({on:function(t,e,s){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),console.assert(!method,"Event callback is null"),this._events[t].push({callback:e,context:s||this}),this},off:function(t,e){if(method){var s=this._events[t];if(s)for(var n in s)s[n].callback==e&&s.splice(n,1)}else t?this._events[t]=[]:this._events={}},trigger:function(t){if(!this._events[t])return this;for(var e,s=this._events[t],n=0,i=s[t].length;i>n&&(e=s[n],e);n++)e.callback.apply(e.context,Array.prototype.slice.call(argments,1));return this},listenTo:function(){console.assert(!1)},stopListening:function(){console.assert(!1)}}),e.Loader=e.Events({}),e.Scene=e.Class.extend({enter:function(){},exit:function(){}}),e.Timer=e.Class.extend({},{tick:function(){var t=Date.now(),e=this.lastTime;return this.lastTime=t,t-e}}),e.World=e.Class.extend({running:!1,stepSize:.03,maxTick:.05,stepProgress:0,color:"#f9f9f9",init:function(s){this.setCanvas(s),this.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},this._requestAnimBind=this._requestAnim.bind(this),this.drawSystem=new e.DrawSystem(this.context),this.updateSystem=new e.UpdateSystem,this.mouseSystem=new e.MouseSystem(this.canvas),this.keySystem=new e.KeySystem},setCanvas:function(t){return this.canvas="string"==typeof t?e.$(t):t,this.context=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this},start:function(){this.running||(this.running=!0,this._requestAnimBind())},stop:function(){return this.running=!1,this},_requestAnim:function(){this.run(),this.running&&this.requestAnimationFrame(this._requestAnimBind,this.canvas)},run:function(){var t=Math.min(e.Timer.tick()/1e3,this.maxTick);for(this.stepProgress+=t;this.stepProgress>=this.stepSize;)this.update();this.draw()},update:function(){this.updateSystem.processAll()},draw:function(){this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height),this.drawSystem.processAll()}}),e.Image=e.Class.extend({}),e.SceneManager=e.Class.extend({lastScene:null,init:function(){this.scenes={}},add:function(t,e){this.scenes[t]=e},enter:function(t,e){this.lastScene&&this.lastScene.exit(),this.lastScene=this.scenes[t],this.lastScene.enter(e)}}),e.Sound=e.Class.extend({}),e.DrawSystem=e.System.extend({}),e.KeySystem=e.System.extend({}),e.MouseSystem=e.System.extend({}),e.System=e.Class.extend({init:function(){this.entities=[]},processAll:function(){for(var t in this.entities)this.process(this.entities[t])}}),e.UpdateSystem=e.System.extend({})})(this);